<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>装饰器深入 | 百草春生</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./assets/img/favicon.ico">
    <meta name="description" content="glaucus技术博客">
    <meta name="author" content="百草春生">
    <meta name="keywords" content="Java,Golang,后端开发">
    
    <link rel="preload" href="./assets/css/0.styles.22c4509e.css" as="style"><link rel="preload" href="./assets/js/app.ed7a6a80.js" as="script"><link rel="preload" href="./assets/js/2.6bc427bd.js" as="script"><link rel="preload" href="./assets/js/44.090493f7.js" as="script"><link rel="prefetch" href="./assets/js/10.089a59d3.js"><link rel="prefetch" href="./assets/js/100.9f65e79c.js"><link rel="prefetch" href="./assets/js/101.21cde4e7.js"><link rel="prefetch" href="./assets/js/102.6fd88697.js"><link rel="prefetch" href="./assets/js/103.359357f4.js"><link rel="prefetch" href="./assets/js/11.0d2a9ef2.js"><link rel="prefetch" href="./assets/js/12.8c47fe05.js"><link rel="prefetch" href="./assets/js/13.8554091e.js"><link rel="prefetch" href="./assets/js/14.16673f13.js"><link rel="prefetch" href="./assets/js/15.3d54afd2.js"><link rel="prefetch" href="./assets/js/16.430c3482.js"><link rel="prefetch" href="./assets/js/17.0db74b9b.js"><link rel="prefetch" href="./assets/js/18.982dc2ff.js"><link rel="prefetch" href="./assets/js/19.f2663e04.js"><link rel="prefetch" href="./assets/js/20.5852a115.js"><link rel="prefetch" href="./assets/js/21.dcac2fab.js"><link rel="prefetch" href="./assets/js/22.480c3e77.js"><link rel="prefetch" href="./assets/js/23.4b471df5.js"><link rel="prefetch" href="./assets/js/24.c4d43955.js"><link rel="prefetch" href="./assets/js/25.63c16b7a.js"><link rel="prefetch" href="./assets/js/26.de87ddff.js"><link rel="prefetch" href="./assets/js/27.5ff9e71c.js"><link rel="prefetch" href="./assets/js/28.9ce70dfe.js"><link rel="prefetch" href="./assets/js/29.693254da.js"><link rel="prefetch" href="./assets/js/3.94f5e9c9.js"><link rel="prefetch" href="./assets/js/30.ccde335c.js"><link rel="prefetch" href="./assets/js/31.f472c9d7.js"><link rel="prefetch" href="./assets/js/32.0ee8786c.js"><link rel="prefetch" href="./assets/js/33.5978dd53.js"><link rel="prefetch" href="./assets/js/34.e437105d.js"><link rel="prefetch" href="./assets/js/35.d8b3fd41.js"><link rel="prefetch" href="./assets/js/36.dc9c7a19.js"><link rel="prefetch" href="./assets/js/37.598797b7.js"><link rel="prefetch" href="./assets/js/38.bffc1a9f.js"><link rel="prefetch" href="./assets/js/39.a496adf1.js"><link rel="prefetch" href="./assets/js/4.e5ac8b52.js"><link rel="prefetch" href="./assets/js/40.1c502242.js"><link rel="prefetch" href="./assets/js/41.8e124ccd.js"><link rel="prefetch" href="./assets/js/42.560b1846.js"><link rel="prefetch" href="./assets/js/43.509c31dd.js"><link rel="prefetch" href="./assets/js/45.36d9c506.js"><link rel="prefetch" href="./assets/js/46.ba9ab5f2.js"><link rel="prefetch" href="./assets/js/47.bf5ae339.js"><link rel="prefetch" href="./assets/js/48.98c7dce0.js"><link rel="prefetch" href="./assets/js/49.fbe69aaf.js"><link rel="prefetch" href="./assets/js/5.c11f0763.js"><link rel="prefetch" href="./assets/js/50.2fcc044a.js"><link rel="prefetch" href="./assets/js/51.99003659.js"><link rel="prefetch" href="./assets/js/52.538d5e22.js"><link rel="prefetch" href="./assets/js/53.e429e1ed.js"><link rel="prefetch" href="./assets/js/54.a6f67a4b.js"><link rel="prefetch" href="./assets/js/55.5ed0d0db.js"><link rel="prefetch" href="./assets/js/56.90e8bdf9.js"><link rel="prefetch" href="./assets/js/57.bd49cc5b.js"><link rel="prefetch" href="./assets/js/58.696f8423.js"><link rel="prefetch" href="./assets/js/59.c6789649.js"><link rel="prefetch" href="./assets/js/6.513c8ad6.js"><link rel="prefetch" href="./assets/js/60.56fe82c8.js"><link rel="prefetch" href="./assets/js/61.3a408ed7.js"><link rel="prefetch" href="./assets/js/62.a3630e78.js"><link rel="prefetch" href="./assets/js/63.6ab9d691.js"><link rel="prefetch" href="./assets/js/64.55200531.js"><link rel="prefetch" href="./assets/js/65.a636362c.js"><link rel="prefetch" href="./assets/js/66.93548848.js"><link rel="prefetch" href="./assets/js/67.b4b0ef80.js"><link rel="prefetch" href="./assets/js/68.a69dd0ee.js"><link rel="prefetch" href="./assets/js/69.79859b74.js"><link rel="prefetch" href="./assets/js/7.9f0383d5.js"><link rel="prefetch" href="./assets/js/70.265cb375.js"><link rel="prefetch" href="./assets/js/71.d2b2b6c6.js"><link rel="prefetch" href="./assets/js/72.30b3a6d6.js"><link rel="prefetch" href="./assets/js/73.38308599.js"><link rel="prefetch" href="./assets/js/74.dd6deadc.js"><link rel="prefetch" href="./assets/js/75.138dac3f.js"><link rel="prefetch" href="./assets/js/76.9fe5b0e3.js"><link rel="prefetch" href="./assets/js/77.a0459432.js"><link rel="prefetch" href="./assets/js/78.47663224.js"><link rel="prefetch" href="./assets/js/79.caf768e6.js"><link rel="prefetch" href="./assets/js/8.b977ce57.js"><link rel="prefetch" href="./assets/js/80.7f22b678.js"><link rel="prefetch" href="./assets/js/81.e0c438af.js"><link rel="prefetch" href="./assets/js/82.10845c61.js"><link rel="prefetch" href="./assets/js/83.b44b0890.js"><link rel="prefetch" href="./assets/js/84.fe9f3b95.js"><link rel="prefetch" href="./assets/js/85.b6e913aa.js"><link rel="prefetch" href="./assets/js/86.ebf0c7ae.js"><link rel="prefetch" href="./assets/js/87.70d8e15f.js"><link rel="prefetch" href="./assets/js/88.44a94037.js"><link rel="prefetch" href="./assets/js/89.cd714385.js"><link rel="prefetch" href="./assets/js/9.85a0d82a.js"><link rel="prefetch" href="./assets/js/90.495c0af0.js"><link rel="prefetch" href="./assets/js/91.e3dcaece.js"><link rel="prefetch" href="./assets/js/92.cb0f42a7.js"><link rel="prefetch" href="./assets/js/93.3fdec098.js"><link rel="prefetch" href="./assets/js/94.e7f95d83.js"><link rel="prefetch" href="./assets/js/95.d6eddedc.js"><link rel="prefetch" href="./assets/js/96.fd85d1af.js"><link rel="prefetch" href="./assets/js/97.d8c96ef8.js"><link rel="prefetch" href="./assets/js/98.8d262881.js"><link rel="prefetch" href="./assets/js/99.29ad6600.js">
    <link rel="stylesheet" href="./assets/css/0.styles.22c4509e.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">百草春生</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link">首页</a></div><div class="nav-item"><a href="/./categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/./tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/./pages/8c2319/" class="nav-link">指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="模块" class="dropdown-title"><!----> <span class="title" style="display:;">模块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./pages/bf6a41/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/./pages/416f59/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/./pages/416f59/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/./pages/ecb94e/" class="nav-link">Golang</a></li><li class="dropdown-item"><!----> <a href="/./pages/eeefb8/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/./pages/5111ec/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/./pages/de595b/" class="nav-link">折腾</a></li></ul></div></div><div class="nav-item"><a href="/./archives/" class="nav-link">归档</a></div> <a href="https://github.com/glaucus" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link">首页</a></div><div class="nav-item"><a href="/./categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/./tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/./pages/8c2319/" class="nav-link">指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="模块" class="dropdown-title"><!----> <span class="title" style="display:;">模块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./pages/bf6a41/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/./pages/416f59/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/./pages/416f59/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/./pages/ecb94e/" class="nav-link">Golang</a></li><li class="dropdown-item"><!----> <a href="/./pages/eeefb8/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/./pages/5111ec/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/./pages/de595b/" class="nav-link">折腾</a></li></ul></div></div><div class="nav-item"><a href="/./archives/" class="nav-link">归档</a></div> <a href="https://github.com/glaucus" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./pages/ecb94e/" class="sidebar-link">python基础语法</a></li><li><a href="/./pages/d507ca/" class="sidebar-link">python并发编程</a></li><li><a href="/./pages/718bee/" aria-current="page" class="active sidebar-link">装饰器深入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./pages/718bee/#闭包" class="sidebar-link">闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./pages/718bee/#闭包的定义" class="sidebar-link">闭包的定义</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#形成闭包的条件" class="sidebar-link">形成闭包的条件</a></li></ul></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#装饰器" class="sidebar-link">装饰器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./pages/718bee/#装饰器的条件" class="sidebar-link">装饰器的条件</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#装饰器语法糖" class="sidebar-link">装饰器语法糖</a></li></ul></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#函数的函数装饰器-函数作为函数的装饰器" class="sidebar-link">函数的函数装饰器（函数作为函数的装饰器）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./pages/718bee/#不带参数的装饰器函数" class="sidebar-link">不带参数的装饰器函数</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#本质" class="sidebar-link">本质</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#带参数的装饰器函数" class="sidebar-link">带参数的装饰器函数</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#本质-2" class="sidebar-link">本质</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#注意-装饰器返回的是一个全新的函数" class="sidebar-link">注意：装饰器返回的是一个全新的函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#函数的类装饰器-类作为函数的装饰器" class="sidebar-link">函数的类装饰器（类作为函数的装饰器）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./pages/718bee/#不带参数的装饰器类" class="sidebar-link">不带参数的装饰器类</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#带参数的装饰器类" class="sidebar-link">带参数的装饰器类</a></li></ul></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#类的函数装饰器-函数作为类的装饰器" class="sidebar-link">类的函数装饰器（函数作为类的装饰器）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./pages/718bee/#不带参数" class="sidebar-link">不带参数</a></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#带参数" class="sidebar-link">带参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/./pages/718bee/#类作为类的装饰器" class="sidebar-link">类作为类的装饰器</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python爬虫</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./pages/751d06/" class="sidebar-link">requests模块入门</a></li><li><a href="/./pages/d65a18/" class="sidebar-link">验证码识别和模拟登录</a></li><li><a href="/./pages/9515ef/" class="sidebar-link">多线程爬取梨视频网站的热门视频</a></li><li><a href="/./pages/838f16/" class="sidebar-link">selenium模块</a></li><li><a href="/./pages/e1034c/" class="sidebar-link">python配合ffmpeg下载bilibili视频</a></li><li><a href="/./pages/58243a/" class="sidebar-link">scrapy框架入门</a></li><li><a href="/./pages/c8284e/" class="sidebar-link">scrapy进阶</a></li><li><a href="/./pages/7519ed/" class="sidebar-link">CrawlSpider全站爬取</a></li><li><a href="/./pages/0597b3/" class="sidebar-link">分布式爬虫和增量式爬虫</a></li><li><a href="/./pages/940b45/" class="sidebar-link">增量式爬虫实践案例 下载指定b站up主的所有作品</a></li><li><a href="/./pages/c65839/" class="sidebar-link">小红书图片爬虫</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PythonWeb</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./pages/52801e/" class="sidebar-link">pymysql使用</a></li><li><a href="/./pages/16ddbf/" class="sidebar-link">Django入门</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>脚本及其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./pages/b410ea/" class="sidebar-link">argparse模块入门</a></li><li><a href="/./pages/d22088/" class="sidebar-link">切换windows代理设置开关</a></li><li><a href="/./pages/9abbdb/" class="sidebar-link">Alfred插件-快速使用编辑器打开指定文件</a></li><li><a href="/./pages/4a7cac/" class="sidebar-link">youtube-upload</a></li><li><a href="/./pages/231611/" class="sidebar-link">Python读取excel &amp; 使用ssh通道连接rds更新数据</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/./" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/./categories/?category=golang" title="分类" data-v-1cd794fe>golang</a></li> <li data-v-1cd794fe><a href="/./categories/?category=Python%E5%9F%BA%E7%A1%80" title="分类" data-v-1cd794fe>Python基础</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/glaucus169" target="_blank" title="作者" class="beLink" data-v-1cd794fe>glaucus</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-05-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          装饰器深入
        </h1>  <div class="theme-vdoing-content content__default"><h1 id="装饰器深入"><a href="#装饰器深入" class="header-anchor">#</a> 装饰器深入</h1> <h2 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h2> <h3 id="闭包的定义"><a href="#闭包的定义" class="header-anchor">#</a> 闭包的定义</h3> <p>如果在一个外部函数中定义一个内部函数，内部函数对外部作用域（但不是在全局作用域）的变量进行引用，外部函数的返回值是内部函数，这样的函数就被认为是闭包(closure)。</p> <h3 id="形成闭包的条件"><a href="#形成闭包的条件" class="header-anchor">#</a> 形成闭包的条件</h3> <ul><li>必须有内部函数</li> <li>内部函数必须引用外部函数的变量</li> <li>外部函数返回值必须是内部函数</li></ul> <h2 id="装饰器"><a href="#装饰器" class="header-anchor">#</a> 装饰器</h2> <p>python装饰器实质上也是一个闭包函数，目的是在不改变原函数的情况下实现对原函数功能的增强。（类似Spring中的AOP）</p> <h3 id="装饰器的条件"><a href="#装饰器的条件" class="header-anchor">#</a> 装饰器的条件</h3> <ul><li>不修改已有函数代码</li> <li>不修改已有函数的调用方式</li> <li>给已有函数增加额外功能</li></ul> <h3 id="装饰器语法糖"><a href="#装饰器语法糖" class="header-anchor">#</a> 装饰器语法糖</h3> <p><code>@装饰器函数名</code></p> <p><code>@装饰器类名</code></p> <p><code>@装饰器函数名(param)</code></p> <p><code>@装饰器类名(param)</code></p> <h2 id="函数的函数装饰器-函数作为函数的装饰器"><a href="#函数的函数装饰器-函数作为函数的装饰器" class="header-anchor">#</a> 函数的函数装饰器（函数作为函数的装饰器）</h2> <h3 id="不带参数的装饰器函数"><a href="#不带参数的装饰器函数" class="header-anchor">#</a> 不带参数的装饰器函数</h3> <blockquote><p>这里的不带参数是指<code>@装饰器</code>后没有<code>(参数)</code>而非装饰器函数没有参数</p></blockquote> <p>例如下面的<code>record</code>函数就是一个简单装饰器，作用是记录被装饰函数的执行耗时</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time


<span class="token keyword">def</span> <span class="token function">record</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'====start===='</span><span class="token punctuation">)</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'===end cost : </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string"> seconds==='</span></span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> decorator


<span class="token decorator annotation punctuation">@record</span> <span class="token comment"># 不带参数</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'my name is </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string"> years old'</span></span><span class="token punctuation">)</span>


test<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>



<span class="token operator">==</span><span class="token operator">==</span>start<span class="token operator">==</span><span class="token operator">==</span>
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
<span class="token operator">==</span><span class="token operator">=</span>end cost <span class="token punctuation">:</span> <span class="token number">1.0049748420715332</span> seconds<span class="token operator">==</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="本质"><a href="#本质" class="header-anchor">#</a> 本质</h3> <p>在上述不带参数的装饰器函数例子中，14行<code>@record</code>实质上等于<code>test = record(test)</code>,最终调用<code>test('tom',18)</code>的伪代码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'====start===='</span><span class="token punctuation">)</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># func(*args, **kwargs) </span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># -&gt; 原始的test('tom',18)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'my name is </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string"> years old'</span></span><span class="token punctuation">)</span> <span class="token comment"># -&gt; 原始的test('tom',18)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'===end cost : </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string"> seconds==='</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="带参数的装饰器函数"><a href="#带参数的装饰器函数" class="header-anchor">#</a> 带参数的装饰器函数</h3> <p>python中一切皆对象，如果在对象后跟<code>()</code>即是执行调用的意思，例如函数，类，类里的函数，实现了<code>__call__</code>方法的对象都可以被调用，因为这些对象是<code>callable</code>对象。还是刚才的例子，<code>@装饰器(参数)</code>语法，实际上是在不带参数的装饰器函数基础上包了一层，由<code>test = record(test)</code>变成了<code>decorator = record(count); test = decorator(test)</code>。</p> <p>例子如下</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">record</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'====start===='</span><span class="token punctuation">)</span>
            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> _num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
                func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'===end cost : </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string"> seconds==='</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> wrapper

    <span class="token keyword">return</span> decorator


<span class="token decorator annotation punctuation">@record</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'my name is </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string"> years old'</span></span><span class="token punctuation">)</span>


test<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">==</span><span class="token operator">==</span>start<span class="token operator">==</span><span class="token operator">==</span>
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
<span class="token operator">==</span><span class="token operator">=</span>end cost <span class="token punctuation">:</span> <span class="token number">5.020708799362183</span> seconds<span class="token operator">==</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="本质-2"><a href="#本质-2" class="header-anchor">#</a> 本质</h3> <p>带参数的装饰器，实际就是加了一层函数的嵌套，可以把这种装饰器拆成两步分析，第一步执行<code>record(5)</code>返回了函数<code>decorator</code>,<code>@decorator</code>这样就是不带参数的装饰器形式了。</p> <h3 id="注意-装饰器返回的是一个全新的函数"><a href="#注意-装饰器返回的是一个全新的函数" class="header-anchor">#</a> 注意：装饰器返回的是一个全新的函数</h3> <p>装饰器<strong>返回的是一个全新的函数</strong>，对函数的装饰方法（常写成<code>wrapper</code>）的参数列表为了兼容性可以写为<code>(*args, **kwargs)</code>，但是这个函数的参数实际可以写为任意形式（只要该参数包含被装饰函数的参数列表即可），回归到定义上来说就是<code>不修改已有函数的调用方式</code>即可。网上教程中通常把<code>wrapper</code>的参数写成和被装饰函数一致，很容易让人误以为这两者的参数列表必须保持一致。</p> <p>例子：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass


<span class="token decorator annotation punctuation">@dataclass</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    info<span class="token punctuation">:</span> <span class="token builtin">tuple</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">record</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'====start===='</span><span class="token punctuation">)</span>
            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> _num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
                func<span class="token punctuation">(</span><span class="token operator">*</span>user<span class="token punctuation">.</span>info<span class="token punctuation">)</span>

            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'===end cost : </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string"> seconds==='</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> wrapper

    <span class="token keyword">return</span> decorator


<span class="token decorator annotation punctuation">@record</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'my name is </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string"> years old'</span></span><span class="token punctuation">)</span>


<span class="token comment"># test('tom', 18)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
tom <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> info<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test<span class="token punctuation">(</span>tom<span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>

wrapper
<span class="token operator">==</span><span class="token operator">==</span>start<span class="token operator">==</span><span class="token operator">==</span>
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
<span class="token operator">==</span><span class="token operator">=</span>end cost <span class="token punctuation">:</span> <span class="token number">5.013930797576904</span> seconds<span class="token operator">==</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>可以看到，<code>test</code>函数的name为<code>wrapper</code>，也就是装饰功能的函数的名字，而且这里<code>test函数</code>的参数列表也已经变成了<code>(user)</code>，也就是这里实际上<code>test = wrapper(user)</code>。如果使用装饰器后，想保留原函数的名称，可以使用<code>@functools.wraps</code>来装饰<code>wrapper函数</code>。</p> <p>例子：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> functools
<span class="token keyword">import</span> time
<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass


<span class="token decorator annotation punctuation">@dataclass</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    info<span class="token punctuation">:</span> <span class="token builtin">tuple</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">record</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'====start===='</span><span class="token punctuation">)</span>
            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> _num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
                func<span class="token punctuation">(</span><span class="token operator">*</span>user<span class="token punctuation">.</span>info<span class="token punctuation">)</span>

            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'===end cost : </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string"> seconds==='</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> wrapper

    <span class="token keyword">return</span> decorator


<span class="token decorator annotation punctuation">@record</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'my name is </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string"> years old'</span></span><span class="token punctuation">)</span>


<span class="token comment"># test('tom', 18)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
tom <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> info<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test<span class="token punctuation">(</span>tom<span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>

test
<span class="token operator">==</span><span class="token operator">==</span>start<span class="token operator">==</span><span class="token operator">==</span>
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
my name <span class="token keyword">is</span> tom<span class="token punctuation">,</span> <span class="token number">18</span> years old
<span class="token operator">==</span><span class="token operator">=</span>end cost <span class="token punctuation">:</span> <span class="token number">5.015993118286133</span> seconds<span class="token operator">==</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>可以看到，在对<code>test</code>进行了装饰后,返回的新的函数名称还是保持为<code>test</code></p> <h2 id="函数的类装饰器-类作为函数的装饰器"><a href="#函数的类装饰器-类作为函数的装饰器" class="header-anchor">#</a> 函数的类装饰器（类作为函数的装饰器）</h2> <h3 id="不带参数的装饰器类"><a href="#不带参数的装饰器类" class="header-anchor">#</a> 不带参数的装饰器类</h3> <p>类也可以作为装饰器使用，需要实现<code>__init__</code>函数和<code>__call__</code>函数,例子：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>func <span class="token operator">=</span> func

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> self<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Time : </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ret


<span class="token decorator annotation punctuation">@Timer</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b

<span class="token comment"># 等价于 add = Timer(add)</span>
  
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="带参数的装饰器类"><a href="#带参数的装饰器类" class="header-anchor">#</a> 带参数的装饰器类</h3> <p>类似带参数的装饰器函数，带参数的装饰器类需要在<code>__call__</code>函数内部，再包一层</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pre_fix<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>pre_fix <span class="token operator">=</span> pre_fix

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            ret <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>pre_fix<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> ret

        <span class="token keyword">return</span> wrapper


<span class="token decorator annotation punctuation">@Timer</span><span class="token punctuation">(</span>pre_fix<span class="token operator">=</span><span class="token string">'current_time'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b


<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="类的函数装饰器-函数作为类的装饰器"><a href="#类的函数装饰器-函数作为类的装饰器" class="header-anchor">#</a> 类的函数装饰器（函数作为类的装饰器）</h2> <h3 id="不带参数"><a href="#不带参数" class="header-anchor">#</a> 不带参数</h3> <p>函数也可以装饰类，下面的例子中，<code>add_str</code>是一个参数为<code>class</code>,返回值也是<code>class</code>的函数，装饰了MyObj类，作用是<code>把被装饰类的__str__函数替换为打印self.__dict__</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">add_str</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>

    cls<span class="token punctuation">.</span>__str__ <span class="token operator">=</span> __str__
    <span class="token keyword">return</span> cls


<span class="token decorator annotation punctuation">@add_str</span>
<span class="token keyword">class</span> <span class="token class-name">MyObj</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> a
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> b


<span class="token keyword">print</span><span class="token punctuation">(</span>MyObj<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>

<span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="带参数"><a href="#带参数" class="header-anchor">#</a> 带参数</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">add_str</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">_cls</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'调用时间 </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">}</span></span><span class="token string"> 点 == '</span></span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>

        cls<span class="token punctuation">.</span>__str__ <span class="token operator">=</span> __str__

        <span class="token keyword">return</span> cls

    <span class="token keyword">return</span> _cls


<span class="token decorator annotation punctuation">@add_str</span><span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token string">'19'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyObj</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> a
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> b


<span class="token keyword">print</span><span class="token punctuation">(</span>MyObj<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>

调用时间 <span class="token number">19</span> 点 <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="类作为类的装饰器"><a href="#类作为类的装饰器" class="header-anchor">#</a> 类作为类的装饰器</h2> <p>没什么意义</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/glaucus/edit/main/docs/03.golang/01.Python基础/03.装饰器深入.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/./tags/?tag=%E8%A3%85%E9%A5%B0%E5%99%A8" title="标签">#装饰器</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/08/31, 11:25:15</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/./pages/d507ca/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">python并发编程</div></a> <a href="/./pages/751d06/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">requests模块入门</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/./pages/d507ca/" class="prev">python并发编程</a></span> <span class="next"><a href="/./pages/751d06/">requests模块入门</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/glaucus169" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/glaucusZh" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="mailto:storyxc@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span><a href="http://storyxc.com" target="_blank" style="font-weight:bold">story</a> | <a href="http://beian.miit.gov.cn/" target=_blank>豫ICP备19046036号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.ed7a6a80.js" defer></script><script src="./assets/js/2.6bc427bd.js" defer></script><script src="./assets/js/44.090493f7.js" defer></script>
  </body>
</html>
